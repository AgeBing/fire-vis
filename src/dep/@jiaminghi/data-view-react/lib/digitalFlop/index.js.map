{"version":3,"file":"index.js","sources":["../../src/components/digitalFlop/index.js"],"sourcesContent":["import React, { useEffect, useRef, useMemo } from 'react'\r\n\r\nimport PropTypes from 'prop-types'\r\n\r\nimport classnames from 'classnames'\r\n\r\nimport CRender from '@jiaminghi/c-render'\r\n\r\nimport '@jiaminghi/charts/lib/extend/index'\r\n\r\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index'\r\n\r\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util'\r\n\r\nimport './style.less'\r\n\r\nconst defaultConfig = {\r\n  /**\r\n   * @description Number for digital flop\r\n   * @type {Array<Number>}\r\n   * @default number = []\r\n   * @example number = [10]\r\n   */\r\n  number: [],\r\n  /**\r\n   * @description Content formatter\r\n   * @type {String}\r\n   * @default content = ''\r\n   * @example content = '{nt}个'\r\n   */\r\n  content: '',\r\n  /**\r\n   * @description Number toFixed\r\n   * @type {Number}\r\n   * @default toFixed = 0\r\n   */\r\n  toFixed: 0,\r\n  /**\r\n   * @description Text align\r\n   * @type {String}\r\n   * @default textAlign = 'center'\r\n   * @example textAlign = 'center' | 'left' | 'right'\r\n   */\r\n  textAlign: 'center',\r\n  /**\r\n   * @description Text style configuration\r\n   * @type {Object} {CRender Class Style}\r\n   */\r\n  style: {\r\n    fontSize: 30,\r\n    fill: '#3de7c9'\r\n  },\r\n  /**\r\n   * @description CRender animationCurve\r\n   * @type {String}\r\n   * @default animationCurve = 'easeOutCubic'\r\n   */\r\n  animationCurve: 'easeOutCubic',\r\n  /**\r\n   * @description CRender animationFrame\r\n   * @type {String}\r\n   * @default animationFrame = 50\r\n   */\r\n  animationFrame: 50\r\n}\r\n\r\nconst DigitalFlop = ({ config = {}, className, style }) => {\r\n  const domRef = useRef(null)\r\n  const rendererRef = useRef(null)\r\n  const graphRef = useRef(null)\r\n\r\n  function getGraph(mergedConfig) {\r\n    const { animationCurve, animationFrame } = mergedConfig\r\n\r\n    return rendererRef.current.add({\r\n      name: 'numberText',\r\n      animationCurve,\r\n      animationFrame,\r\n      shape: getShape(mergedConfig),\r\n      style: getStyle(mergedConfig)\r\n    })\r\n  }\r\n\r\n  function getShape({ number, content, toFixed, textAlign }) {\r\n    const [w, h] = rendererRef.current.area\r\n\r\n    const position = [w / 2, h / 2]\r\n\r\n    if (textAlign === 'left') position[0] = 0\r\n    if (textAlign === 'right') position[0] = w\r\n\r\n    return { number, content, toFixed, position }\r\n  }\r\n\r\n  function getStyle({ style, textAlign }) {\r\n    return deepMerge(style, {\r\n      textAlign,\r\n      textBaseline: 'middle'\r\n    })\r\n  }\r\n\r\n  useEffect(() => {\r\n    const mergedConfig = deepMerge(deepClone(defaultConfig, true), config || {})\r\n\r\n    if (!rendererRef.current) {\r\n      rendererRef.current = new CRender(domRef.current)\r\n\r\n      graphRef.current = getGraph(mergedConfig)\r\n    }\r\n\r\n    const graph = graphRef.current\r\n    graph.animationEnd()\r\n\r\n    const shape = getShape(mergedConfig)\r\n\r\n    const cacheNum = graph.shape.number.length\r\n    const shapeNum = shape.number.length\r\n\r\n    cacheNum !== shapeNum && (graph.shape.number = shape.number)\r\n\r\n    const { animationCurve, animationFrame } = mergedConfig\r\n\r\n    Object.assign(graph, { animationCurve, animationFrame })\r\n\r\n    graph.animation('style', getStyle(mergedConfig), true)\r\n    graph.animation('shape', shape)\r\n  }, [config])\r\n\r\n  const classNames = useMemo(() => classnames('dv-digital-flop', className), [\r\n    className\r\n  ])\r\n\r\n  return (\r\n    <div className={classNames} style={style}>\r\n      <canvas ref={domRef} />\r\n    </div>\r\n  )\r\n}\r\n\r\nDigitalFlop.propTypes = {\r\n  config: PropTypes.object,\r\n  className: PropTypes.string,\r\n  style: PropTypes.object\r\n}\r\n\r\n// 指定 props 的默认值：\r\nDigitalFlop.defaultProps = {\r\n  config: {}\r\n}\r\n\r\nexport default DigitalFlop\r\n"],"names":["defaultConfig","DigitalFlop","config","className","style","domRef","useRef","rendererRef","graphRef","getGraph","mergedConfig","animationCurve","animationFrame","current","add","getShape","getStyle","number","content","toFixed","textAlign","area","w","h","position","deepMerge","deepClone","CRender","graph","animationEnd","shape","cacheNum","length","shapeNum","assign","animation","classNames","useMemo","classnames","React","propTypes","PropTypes","object","string","defaultProps"],"mappings":"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"}