{"version":3,"file":"index.js","sources":["../../src/components/capsuleChart/index.js"],"sourcesContent":["import React, { useEffect, useState, useMemo } from 'react'\r\n\r\nimport PropTypes from 'prop-types'\r\n\r\nimport classnames from 'classnames'\r\n\r\nimport { deepMerge } from '@jiaminghi/charts/lib/util/index'\r\n\r\nimport { deepClone } from '@jiaminghi/c-render/lib/plugin/util'\r\n\r\nimport './style.less'\r\n\r\nconst defaultConfig = {\r\n  /**\r\n   * @description Capsule chart data\r\n   * @type {Array<Object>}\r\n   * @default data = []\r\n   * @example data = [{ name: 'foo1', value: 100 }, { name: 'foo2', value: 100 }]\r\n   */\r\n  data: [],\r\n  /**\r\n   * @description Colors (hex|rgb|rgba|color keywords)\r\n   * @type {Array<String>}\r\n   * @default color = ['#37a2da', '#32c5e9', '#67e0e3', '#9fe6b8', '#ffdb5c', '#ff9f7f', '#fb7293']\r\n   * @example color = ['#000', 'rgb(0, 0, 0)', 'rgba(0, 0, 0, 1)', 'red']\r\n   */\r\n  colors: [\r\n    '#37a2da',\r\n    '#32c5e9',\r\n    '#67e0e3',\r\n    '#9fe6b8',\r\n    '#ffdb5c',\r\n    '#ff9f7f',\r\n    '#fb7293'\r\n  ],\r\n  /**\r\n   * @description Chart unit\r\n   * @type {String}\r\n   * @default unit = ''\r\n   */\r\n  unit: ''\r\n}\r\n\r\nconst CapsuleChart = ({ config = {}, className, style }) => {\r\n  const [{ mergedConfig, labelData, capsuleLength }, setState] = useState({\r\n    mergedConfig: null,\r\n    labelData: [],\r\n    capsuleLength: []\r\n  })\r\n\r\n  useEffect(() => {\r\n    const mergedConfig = deepMerge(deepClone(defaultConfig, true), config || {})\r\n\r\n    const { data } = mergedConfig\r\n\r\n    if (!data.length) return\r\n\r\n    const capsuleValue = data.map(({ value }) => value)\r\n\r\n    const maxValue = Math.max(...capsuleValue)\r\n\r\n    const oneFifth = maxValue / 5\r\n\r\n    setState({\r\n      mergedConfig,\r\n      capsuleLength: capsuleValue.map(v => (maxValue ? v / maxValue : 0)),\r\n      labelData: new Array(6).fill(0).map((v, i) => Math.ceil(i * oneFifth))\r\n    })\r\n  }, [config])\r\n\r\n  const classNames = useMemo(() => classnames('dv-capsule-chart', className), [\r\n    className\r\n  ])\r\n\r\n  return (\r\n    <div className={classNames} style={style}>\r\n      {!!mergedConfig && (\r\n        <React.Fragment>\r\n          <div className='label-column'>\r\n            {mergedConfig.data.map(({ name }) => (\r\n              <div key={name}>{name}</div>\r\n            ))}\r\n            <div>&nbsp;</div>\r\n          </div>\r\n\r\n          <div className='capsule-container'>\r\n            {capsuleLength.map((capsule, index) => (\r\n              <div className='capsule-item' key={index}>\r\n                <div\r\n                  style={{\r\n                    width: `${capsule * 100}%`,\r\n                    backgroundColor: `${\r\n                      mergedConfig.colors[index % mergedConfig.colors.length]\r\n                    }`\r\n                  }}\r\n                />\r\n              </div>\r\n            ))}\r\n            <div className='unit-label'>\r\n              {labelData.map((label, index) => (\r\n                <div key={label + index}>{label}</div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {!!mergedConfig.unit && (\r\n            <div className='unit-text'>{mergedConfig.unit}</div>\r\n          )}\r\n        </React.Fragment>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nCapsuleChart.propTypes = {\r\n  config: PropTypes.object,\r\n  className: PropTypes.string,\r\n  style: PropTypes.object\r\n}\r\n\r\n// 指定 props 的默认值：\r\nCapsuleChart.defaultProps = {\r\n  config: {}\r\n}\r\n\r\nexport default CapsuleChart\r\n"],"names":["defaultConfig","CapsuleChart","config","className","style","useState","mergedConfig","labelData","capsuleLength","setState","deepMerge","deepClone","data","length","capsuleValue","map","value","maxValue","Math","max","oneFifth","v","Array","fill","i","ceil","classNames","useMemo","classnames","React","name","capsule","index","colors","label","unit","propTypes","PropTypes","object","string","defaultProps"],"mappings":";;;;;;;;;;;;;;AAYA,IAAMA,gBAAgB;;;;;;;QAOd,EAPc;;;;;;;UAcZ,CACN,SADM,EAEN,SAFM,EAGN,SAHM,EAIN,SAJM,EAKN,SALM,EAMN,SANM,EAON,SAPM,CAdY;;;;;;QA4Bd;CA5BR;;AA+BA,IAAMC,eAAe,SAAfA,YAAe,OAAuC;yBAApCC,MAAoC;MAApCA,MAAoC,+BAA3B,EAA2B;MAAvBC,SAAuB,QAAvBA,SAAuB;MAAZC,KAAY,QAAZA,KAAY;;kBACKC,eAAS;kBACxD,IADwD;eAE3D,EAF2D;mBAGvD;GAH8C,CADL;;;MACjDC,YADiD,eACjDA,YADiD;MACnCC,SADmC,eACnCA,SADmC;MACxBC,aADwB,eACxBA,aADwB;MACPC,QADO;;kBAOhD,YAAM;QACRH,eAAeI,iBAAUC,iBAAUX,aAAV,EAAyB,IAAzB,CAAV,EAA0CE,UAAU,EAApD,CAArB;;QAEQU,IAHM,GAGGN,YAHH,CAGNM,IAHM;;;QAKV,CAACA,KAAKC,MAAV,EAAkB;;QAEZC,eAAeF,KAAKG,GAAL,CAAS;UAAGC,KAAH,SAAGA,KAAH;aAAeA,KAAf;KAAT,CAArB;;QAEMC,WAAWC,KAAKC,GAAL,6CAAYL,YAAZ,EAAjB;;QAEMM,WAAWH,WAAW,CAA5B;;aAES;gCAAA;qBAEQH,aAAaC,GAAb,CAAiB;eAAME,WAAWI,IAAIJ,QAAf,GAA0B,CAAhC;OAAjB,CAFR;iBAGI,IAAIK,KAAJ,CAAU,CAAV,EAAaC,IAAb,CAAkB,CAAlB,EAAqBR,GAArB,CAAyB,UAACM,CAAD,EAAIG,CAAJ;eAAUN,KAAKO,IAAL,CAAUD,IAAIJ,QAAd,CAAV;OAAzB;KAHb;GAbF,EAkBG,CAAClB,MAAD,CAlBH;;MAoBMwB,aAAaC,cAAQ;WAAMC,mBAAW,kBAAX,EAA+BzB,SAA/B,CAAN;GAAR,EAAyD,CAC1EA,SAD0E,CAAzD,CAAnB;;SAKE0B;;MAAK,WAAWH,UAAhB,EAA4B,OAAOtB,KAAnC;KACI,CAACE,YAAF,IACCuB;oBAAA,CAAO,QAAP;;;;UACO,WAAU,cAAf;qBACgBjB,IAAb,CAAkBG,GAAlB,CAAsB;cAAGe,IAAH,SAAGA,IAAH;iBACrBD;;cAAK,KAAKC,IAAV;;WADqB;SAAtB,CADH;;;;;;OADF;;;UAQO,WAAU,mBAAf;sBACiBf,GAAd,CAAkB,UAACgB,OAAD,EAAUC,KAAV;iBACjBH;;cAAK,WAAU,cAAf,EAA8B,KAAKG,KAAnC;;qBAEW;uBACKD,UAAU,GAApB,MADK;sCAGHzB,aAAa2B,MAAb,CAAoBD,QAAQ1B,aAAa2B,MAAb,CAAoBpB,MAAhD;;;WANS;SAAlB,CADH;;;YAaO,WAAU,YAAf;oBACaE,GAAV,CAAc,UAACmB,KAAD,EAAQF,KAAR;mBACbH;;gBAAK,KAAKK,QAAQF,KAAlB;;aADa;WAAd;;OAtBP;OA4BI,CAAC1B,aAAa6B,IAAf,IACCN;;UAAK,WAAU,WAAf;qBAAyCM;;;GAhCnD;CA/BF;;AAuEAlC,aAAamC,SAAb,GAAyB;UACfC,yBAAUC,MADK;aAEZD,yBAAUE,MAFE;SAGhBF,yBAAUC;;;CAHnB,CAOArC,aAAauC,YAAb,GAA4B;UAClB;CADV;;;;"}